<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Paper Weather Dashboard</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&family=Playfair+Display:ital@1&display=swap');
        
        :root {
            --white: #FFFFFF;
            --header-bg: #333333;
            --accent-yellow: #FFD700;
            --black: #000000;
            --gray-line: #CDCDC9;
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }
        
        .container {
            width: 800px;
            height: 480px;
            background: var(--white);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        /* Header */
        .header {
            background: var(--header-bg);
            padding: 12px 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }
        
        .header-title {
            font-weight: 800;
            font-size: 22px;
            color: var(--accent-yellow);
        }
        
        .header-separator {
            color: var(--white);
            font-size: 22px;
        }
        
        .header-text {
            font-weight: 700;
            font-size: 22px;
            color: var(--white);
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            display: grid;
            grid-template-columns: 1.5fr 1fr;
            position: relative;
        }
        
        .main-content::after {
            content: '';
            position: absolute;
            left: 60%;
            top: 20px;
            bottom: 20px;
            width: 1px;
            background: var(--gray-line);
        }
        
        /* Left Column - Weather */
        .weather-column {
            padding: 20px 25px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        /* Hero Section */
        .hero-section {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .emoji-face {
            width: 100px;
            height: 100px;
            flex-shrink: 0;
        }
        
        .weather-hero {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
        }
        
        .weather-icon {
            width: 80px;
            height: 80px;
        }
        
        .weather-icon svg {
            width: 100%;
            height: 100%;
        }
        
        .weather-details {
            display: flex;
            flex-direction: column;
        }
        
        .weather-condition {
            font-weight: 500;
            font-size: 20px;
            color: var(--black);
            text-transform: uppercase;
        }
        
        .weather-temp {
            font-weight: 800;
            font-size: 56px;
            color: var(--black);
            line-height: 1;
        }
        
        /* Action Card */
        .action-card {
            border: 2px solid var(--black);
            border-radius: 12px;
            padding: 15px 25px;
            display: flex;
            align-items: center;
        }
        
        .action-text {
            font-weight: 800;
            font-size: 36px;
            color: var(--black);
            line-height: 1.15;
            text-transform: uppercase;
        }
        
        /* Metrics Row */
        .metrics-row {
            display: flex;
            gap: 12px;
            margin-top: auto;
        }
        
        .metric-pill {
            background: var(--black);
            border-radius: 12px;
            padding: 10px 14px;
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }
        
        .metric-icon {
            width: 36px;
            height: 36px;
            flex-shrink: 0;
        }
        
        .metric-icon svg {
            width: 100%;
            height: 100%;
        }
        
        .metric-content {
            display: flex;
            flex-direction: column;
        }
        
        .metric-label {
            font-weight: 500;
            font-size: 12px;
            color: var(--white);
        }
        
        .metric-value {
            font-weight: 700;
            font-size: 18px;
            color: var(--white);
        }
        
        /* Right Column - AQI */
        .aqi-column {
            padding: 20px 25px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }
        
        /* AQI Gauge */
        .aqi-gauge-container {
            width: 180px;
            height: 180px;
        }
        
        .aqi-gauge {
            width: 100%;
            height: 100%;
        }
        
        .aqi-track {
            fill: none;
            stroke: #e0e0e0;
            stroke-width: 20;
        }
        
        .aqi-progress {
            fill: none;
            stroke: var(--accent-yellow);
            stroke-width: 20;
            stroke-linecap: round;
            transform: rotate(-90deg);
            transform-origin: center;
        }
        
        .aqi-center {
            fill: var(--black);
        }
        
        .aqi-label-text {
            font-family: 'Inter', sans-serif;
            font-weight: 500;
            font-size: 14px;
            fill: var(--white);
        }
        
        .aqi-value-text {
            font-family: 'Inter', sans-serif;
            font-weight: 800;
            font-size: 48px;
            fill: var(--accent-yellow);
        }
        
        .aqi-status-text {
            font-family: 'Inter', sans-serif;
            font-weight: 700;
            font-size: 12px;
            fill: var(--white);
            text-transform: uppercase;
        }
        
        /* Hydration Reminder */
        .hydration-reminder {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: auto;
        }
        
        .hydration-icon {
            width: 70px;
            height: 70px;
        }
        
        .hydration-icon svg {
            width: 100%;
            height: 100%;
        }
        
        .hydration-text {
            font-weight: 800;
            font-size: 32px;
            color: var(--black);
            line-height: 1.15;
            text-transform: uppercase;
        }
        
        /* Footer */
        .footer {
            border-top: 1px solid var(--gray-line);
            padding: 10px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .footer-logo {
            width: 40px;
            height: 40px;
        }
        
        .footer-quote {
            font-family: 'Playfair Display', serif;
            font-style: italic;
            font-size: 18px;
            color: var(--black);
        }
        
        .footer-timestamp {
            font-size: 13px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <span class="header-title">Weather & AQI</span>
            <span class="header-separator">|</span>
            <span id="current-date" class="header-text">NOV 24, 2025</span>
            <span class="header-separator">|</span>
            <span id="header-location" class="header-text">HANOI, VIETNAM</span>
        </header>
        
        <!-- Main Content -->
        <main class="main-content">
            <!-- Left Column - Weather -->
            <section class="weather-column">
                <!-- Hero Section -->
                <div class="hero-section">
                    <div class="emoji-face" id="emoji-face">
                        <svg viewBox="0 0 100 100">
                            <circle cx="50" cy="50" r="48" fill="#FFD700"/>
                            <rect x="20" y="38" width="25" height="10" rx="5" fill="#000"/>
                            <rect x="55" y="38" width="25" height="10" rx="5" fill="#000"/>
                            <path d="M30 65 Q50 80 70 65" stroke="#000" stroke-width="4" fill="none" stroke-linecap="round"/>
                        </svg>
                    </div>
                    <div class="weather-hero">
                        <div class="weather-icon" id="weather-icon">
                            <svg viewBox="0 0 80 80" fill="none">
                                <circle cx="35" cy="35" r="18" fill="#FFD700" stroke="#000" stroke-width="3"/>
                                <g stroke="#000" stroke-width="3" stroke-linecap="round">
                                    <line x1="35" y1="5" x2="35" y2="12"/>
                                    <line x1="35" y1="58" x2="35" y2="65"/>
                                    <line x1="5" y1="35" x2="12" y2="35"/>
                                    <line x1="58" y1="35" x2="65" y2="35"/>
                                    <line x1="14" y1="14" x2="19" y2="19"/>
                                    <line x1="51" y1="51" x2="56" y2="56"/>
                                    <line x1="14" y1="56" x2="19" y2="51"/>
                                    <line x1="51" y1="19" x2="56" y2="14"/>
                                </g>
                                <path d="M50 55 Q55 48 62 50 Q72 52 72 62 Q72 72 62 72 L38 72 Q28 72 28 62 Q28 54 36 52 Q40 51 44 54" fill="#fff" stroke="#000" stroke-width="3"/>
                            </svg>
                        </div>
                        <div class="weather-details">
                            <span id="weather-condition" class="weather-condition">SUNNY</span>
                            <span id="weather-temp" class="weather-temp">35째C</span>
                        </div>
                    </div>
                </div>
                
                <!-- Action Card -->
                <div class="action-card">
                    <div id="action-text" class="action-text">WEAR<br>SUNGLASSES</div>
                </div>
                
                <!-- Metrics Row -->
                <div class="metrics-row">
                    <div class="metric-pill">
                        <div class="metric-icon">
                            <svg viewBox="0 0 36 36" fill="none">
                                <path d="M18 4C18 4 8 16 8 22C8 27.5 12.5 32 18 32C23.5 32 28 27.5 28 22C28 16 18 4 18 4Z" fill="#FFD700" stroke="#FFD700" stroke-width="2"/>
                            </svg>
                        </div>
                        <div class="metric-content">
                            <span class="metric-label">Humidity</span>
                            <span id="humidity" class="metric-value">48 %</span>
                        </div>
                    </div>
                    <div class="metric-pill">
                        <div class="metric-icon">
                            <svg viewBox="0 0 36 36" fill="none">
                                <path d="M20 6C20 4.9 19.1 4 18 4C16.9 4 16 4.9 16 6V20C14.2 21 13 22.9 13 25C13 28.3 15.7 31 19 31C22.3 31 25 28.3 25 25C25 22.9 23.8 21 22 20V6Z" stroke="#FFD700" stroke-width="2" fill="none"/>
                                <circle cx="19" cy="25" r="4" fill="#FFD700"/>
                            </svg>
                        </div>
                        <div class="metric-content">
                            <span class="metric-label">Feels Like</span>
                            <span id="feels-like" class="metric-value">40째 C</span>
                        </div>
                    </div>
                    <div class="metric-pill">
                        <div class="metric-icon">
                            <svg viewBox="0 0 36 36" fill="none">
                                <path d="M4 12H22C24.2 12 26 10.2 26 8C26 5.8 24.2 4 22 4" stroke="#FFD700" stroke-width="2" fill="none" stroke-linecap="round"/>
                                <path d="M4 22H26C28.2 22 30 23.8 30 26C30 28.2 28.2 30 26 30" stroke="#FFD700" stroke-width="2" fill="none" stroke-linecap="round"/>
                            </svg>
                        </div>
                        <div class="metric-content">
                            <span class="metric-label">Wind</span>
                            <span id="wind-speed" class="metric-value">10 km/h</span>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Right Column - AQI -->
            <section class="aqi-column">
                <!-- AQI Gauge -->
                <div class="aqi-gauge-container">
                    <svg class="aqi-gauge" viewBox="0 0 180 180">
                        <circle class="aqi-track" cx="90" cy="90" r="75"/>
                        <circle id="aqi-progress" class="aqi-progress" cx="90" cy="90" r="75" 
                                stroke-dasharray="188 471"/>
                        <circle class="aqi-center" cx="90" cy="90" r="60"/>
                        <text class="aqi-label-text" x="90" y="65" text-anchor="middle">AQI</text>
                        <text id="aqi-value" class="aqi-value-text" x="90" y="105" text-anchor="middle">80</text>
                        <text id="aqi-status" class="aqi-status-text" x="90" y="125" text-anchor="middle">UNHEALTHY</text>
                    </svg>
                </div>
                
                <!-- Hydration Reminder -->
                <div class="hydration-reminder">
                    <div class="hydration-icon" id="secondary-icon">
                        <svg viewBox="0 0 70 70" fill="none">
                            <path d="M25 10H45L50 60C50 63 47 66 44 66H26C23 66 20 63 20 60L25 10Z" fill="none" stroke="#000" stroke-width="3"/>
                            <path d="M25 10C25 7 28 4 35 4C42 4 45 7 45 10" stroke="#000" stroke-width="3"/>
                            <path d="M30 30L40 45M40 30L30 45" stroke="#000" stroke-width="3" stroke-linecap="round"/>
                            <path d="M23 50L47 50" stroke="#000" stroke-width="2"/>
                        </svg>
                    </div>
                    <div id="secondary-action-text" class="hydration-text">DRINK<br>WATER</div>
                </div>
            </section>
        </main>
        
        <!-- Footer -->
        <footer class="footer">
            <div class="footer-logo">
                <svg viewBox="0 0 40 40" fill="none">
                    <path d="M20 5L35 35H5L20 5Z" fill="#333"/>
                </svg>
            </div>
            <span id="quote-text" class="footer-quote">"A quiet sea never made a skilled sailor."</span>
            <span id="last-updated" class="footer-timestamp">Update at: 14:30</span>
        </footer>
    </div>

    <script>
        const CONFIG = {
            lat: 21.0285,
            lon: 105.8542,
            locationLabel: 'HANOI, VIETNAM',
            defaultQuote: "A quiet sea never made a skilled sailor.",
        };

        const EMOJI_FACES = {
            sunny: `<svg viewBox="0 0 100 100"><circle cx="50" cy="50" r="48" fill="#FFD700"/><rect x="15" y="35" width="28" height="12" rx="6" fill="#000"/><rect x="57" y="35" width="28" height="12" rx="6" fill="#000"/><path d="M30 65 Q50 80 70 65" stroke="#000" stroke-width="4" fill="none" stroke-linecap="round"/></svg>`,
            rain: `<svg viewBox="0 0 100 100"><circle cx="50" cy="50" r="48" fill="#FFD700"/><circle cx="35" cy="45" r="6" fill="#000"/><circle cx="65" cy="45" r="6" fill="#000"/><path d="M35 70 Q50 60 65 70" stroke="#000" stroke-width="4" fill="none" stroke-linecap="round"/></svg>`,
            cold: `<svg viewBox="0 0 100 100"><circle cx="50" cy="50" r="48" fill="#87CEEB"/><circle cx="35" cy="45" r="5" fill="#000"/><circle cx="65" cy="45" r="5" fill="#000"/><ellipse cx="50" cy="70" rx="10" ry="6" fill="#000"/></svg>`,
        };

        const WEATHER_ICONS = {
            sunny: `<svg viewBox="0 0 80 80" fill="none"><circle cx="35" cy="35" r="18" fill="#FFD700" stroke="#000" stroke-width="3"/><g stroke="#000" stroke-width="3" stroke-linecap="round"><line x1="35" y1="5" x2="35" y2="12"/><line x1="35" y1="58" x2="35" y2="65"/><line x1="5" y1="35" x2="12" y2="35"/><line x1="58" y1="35" x2="65" y2="35"/><line x1="14" y1="14" x2="19" y2="19"/><line x1="51" y1="51" x2="56" y2="56"/><line x1="14" y1="56" x2="19" y2="51"/><line x1="51" y1="19" x2="56" y2="14"/></g><path d="M50 55 Q55 48 62 50 Q72 52 72 62 Q72 72 62 72 L38 72 Q28 72 28 62 Q28 54 36 52 Q40 51 44 54" fill="#fff" stroke="#000" stroke-width="3"/></svg>`,
            rain: `<svg viewBox="0 0 80 80" fill="none"><path d="M20 35 Q20 20 35 20 Q38 10 50 10 Q65 10 65 25 Q75 27 75 40 Q75 50 65 50 L20 50 Q10 50 10 40 Q10 35 20 35Z" fill="#666" stroke="#000" stroke-width="2"/><path d="M25 55L20 70M40 55L35 75M55 55L50 70" stroke="#4A90D9" stroke-width="3" stroke-linecap="round"/></svg>`,
            cold: `<svg viewBox="0 0 80 80" fill="none"><path d="M20 35 Q20 20 35 20 Q38 10 50 10 Q65 10 65 25 Q75 27 75 40 Q75 50 65 50 L20 50 Q10 50 10 40 Q10 35 20 35Z" fill="#B0C4DE" stroke="#000" stroke-width="2"/><circle cx="25" cy="65" r="4" fill="#fff" stroke="#000"/><circle cx="40" cy="70" r="3" fill="#fff" stroke="#000"/><circle cx="55" cy="65" r="5" fill="#fff" stroke="#000"/></svg>`,
        };

        const SECONDARY_ICONS = {
            water: `<svg viewBox="0 0 70 70" fill="none"><path d="M25 10H45L50 60C50 63 47 66 44 66H26C23 66 20 63 20 60L25 10Z" fill="none" stroke="#000" stroke-width="3"/><path d="M25 10C25 7 28 4 35 4C42 4 45 7 45 10" stroke="#000" stroke-width="3"/><path d="M30 30L40 45M40 30L30 45" stroke="#000" stroke-width="3" stroke-linecap="round"/><path d="M23 50L47 50" stroke="#000" stroke-width="2"/></svg>`,
            umbrella: `<svg viewBox="0 0 70 70" fill="none"><path d="M10 40C10 22 22 10 35 10C48 10 60 22 60 40" fill="#000" stroke="#000" stroke-width="2"/><path d="M35 40V58C35 62 32 65 28 65" stroke="#000" stroke-width="3" fill="none" stroke-linecap="round"/></svg>`,
            tea: `<svg viewBox="0 0 70 70" fill="none"><path d="M15 30H50V55C50 60 45 65 40 65H25C20 65 15 60 15 55V30Z" fill="none" stroke="#000" stroke-width="3"/><path d="M50 35H55C60 35 65 40 65 45C65 50 60 55 55 55H50" stroke="#000" stroke-width="3"/><path d="M25 20C25 15 30 10 32 10M35 20C35 12 40 8 42 8" stroke="#000" stroke-width="2" stroke-linecap="round"/></svg>`,
            mask: `<svg viewBox="0 0 70 70" fill="none"><rect x="10" y="25" width="50" height="30" rx="8" fill="#fff" stroke="#000" stroke-width="3"/><path d="M10 35C5 35 5 40 10 40" stroke="#000" stroke-width="2"/><path d="M60 35C65 35 65 40 60 40" stroke="#000" stroke-width="2"/><path d="M20 38H50M20 45H50" stroke="#000" stroke-width="2"/></svg>`,
        };

        const WEATHER_CONDITIONS = {
            rain: {
                codes: [200, 201, 202, 210, 211, 212, 221, 230, 231, 232, 300, 301, 302, 310, 311, 312, 313, 314, 321, 500, 501, 502, 503, 504, 511, 520, 521, 522, 531],
                label: 'RAIN/STORM',
                action: 'BRING<br>UMBRELLA',
                secondaryAction: 'WEAR<br>MASK',
                weatherIcon: 'rain',
                emoji: 'rain',
                secondaryIcon: 'umbrella'
            },
            sunny: {
                codes: [800, 801, 802, 803, 804],
                tempMin: 30,
                label: 'SUNNY',
                action: 'WEAR<br>SUNGLASSES',
                secondaryAction: 'DRINK<br>WATER',
                weatherIcon: 'sunny',
                emoji: 'sunny',
                secondaryIcon: 'water'
            },
            cold: {
                codes: [800, 801, 802, 803, 804, 600, 601, 602, 611, 612, 613, 615, 616, 620, 621, 622],
                tempMax: 15,
                label: 'COLD',
                action: 'WARM<br>TEA',
                secondaryAction: 'STAY<br>WARM',
                weatherIcon: 'cold',
                emoji: 'cold',
                secondaryIcon: 'tea'
            }
        };

        const AQI_LEVELS = [
            { max: 12, status: 'GOOD', color: '#00E400' },
            { max: 35.4, status: 'MODERATE', color: '#FFD700' },
            { max: 55.4, status: 'UNHEALTHY (SG)', color: '#FF7E00' },
            { max: 150.4, status: 'UNHEALTHY', color: '#FF0000' },
            { max: 250.4, status: 'VERY UNHEALTHY', color: '#8F3F97' },
            { max: Infinity, status: 'HAZARDOUS', color: '#7E0023' }
        ];

        function getWeatherCondition(temp, weatherId) {
            if (temp <= 15) return WEATHER_CONDITIONS.cold;
            if (WEATHER_CONDITIONS.rain.codes.includes(weatherId)) return WEATHER_CONDITIONS.rain;
            if (temp >= 30) return WEATHER_CONDITIONS.sunny;
            return WEATHER_CONDITIONS.sunny;
        }

        function getAqiLevel(pm25) {
            return AQI_LEVELS.find(level => pm25 <= level.max) || AQI_LEVELS[AQI_LEVELS.length - 1];
        }

        function updateAqiGauge(pm25) {
            const maxPM25 = 300;
            const normalized = Math.min(pm25 / maxPM25, 1);
            const circumference = 2 * Math.PI * 75;
            const dashArray = `${circumference * normalized} ${circumference}`;
            
            const progressEl = document.getElementById('aqi-progress');
            progressEl.setAttribute('stroke-dasharray', dashArray);
            
            const aqiLevel = getAqiLevel(pm25);
            progressEl.style.stroke = aqiLevel.color;
            
            document.getElementById('aqi-value').textContent = Math.round(pm25);
            document.getElementById('aqi-status').textContent = aqiLevel.status;
        }

        function updateCurrentDate() {
            const now = new Date();
            const months = ['JAN', 'FEB', 'MAR', 'APR', 'MAY', 'JUN', 'JUL', 'AUG', 'SEP', 'OCT', 'NOV', 'DEC'];
            document.getElementById('current-date').textContent = `${months[now.getMonth()]} ${now.getDate()}, ${now.getFullYear()}`;
        }

        function formatTime(date) {
            return `${String(date.getHours()).padStart(2, '0')}:${String(date.getMinutes()).padStart(2, '0')}`;
        }

        function renderDashboard(weatherData, aqiData) {
            const temp = Math.round(weatherData.main?.temp ?? 35);
            const weatherId = weatherData.weather?.[0]?.id ?? 800;
            const humidity = weatherData.main?.humidity ?? 48;
            const feelsLike = Math.round(weatherData.main?.feels_like ?? 40);
            const windSpeed = Math.round((weatherData.wind?.speed ?? 2.78) * 3.6);
            
            const condition = getWeatherCondition(temp, weatherId);
            
            document.getElementById('weather-condition').textContent = condition.label;
            document.getElementById('weather-temp').textContent = `${temp}째C`;
            document.getElementById('action-text').innerHTML = condition.action;
            document.getElementById('secondary-action-text').innerHTML = condition.secondaryAction;
            
            document.getElementById('emoji-face').innerHTML = EMOJI_FACES[condition.emoji] || EMOJI_FACES.sunny;
            document.getElementById('weather-icon').innerHTML = WEATHER_ICONS[condition.weatherIcon] || WEATHER_ICONS.sunny;
            document.getElementById('secondary-icon').innerHTML = SECONDARY_ICONS[condition.secondaryIcon] || SECONDARY_ICONS.water;
            
            document.getElementById('humidity').textContent = `${humidity} %`;
            document.getElementById('feels-like').textContent = `${feelsLike}째 C`;
            document.getElementById('wind-speed').textContent = `${windSpeed} km/h`;
            
            const pm25 = aqiData.list?.[0]?.components?.pm2_5 ?? 80;
            updateAqiGauge(pm25);
            
            document.getElementById('last-updated').textContent = `Update at: ${formatTime(new Date())}`;
        }

        async function loadEnvApiKey() {
            try {
                const module = await import('./env-config.js');
                return module.OPENWEATHER_API_KEY ?? module.default ?? '';
            } catch { return ''; }
        }

        async function fetchWeatherData(key) {
            const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${CONFIG.lat}&lon=${CONFIG.lon}&appid=${key}&units=metric`);
            return response.json();
        }

        async function fetchAQIData(key) {
            const response = await fetch(`https://api.openweathermap.org/data/2.5/air_pollution?lat=${CONFIG.lat}&lon=${CONFIG.lon}&appid=${key}`);
            return response.json();
        }

        async function init() {
            updateCurrentDate();
            
            const fallbackWeather = {
                weather: [{ id: 800, description: 'Sunny' }],
                main: { temp: 35, feels_like: 40, humidity: 48 },
                wind: { speed: 2.78 }
            };
            
            const fallbackAqi = { list: [{ components: { pm2_5: 80 } }] };
            
            const key = await loadEnvApiKey();
            let weatherData = fallbackWeather;
            let aqiData = fallbackAqi;
            
            if (key) {
                try { weatherData = await fetchWeatherData(key); } catch (e) { console.error('Weather fetch failed:', e); }
                try { aqiData = await fetchAQIData(key); } catch (e) { console.error('AQI fetch failed:', e); }
            }
            
            renderDashboard(weatherData, aqiData);
        }

        init();
    </script>
</body>
</html>
